<!DOCTYPE html>
<html>
<head>
    <title>Weight & Calorie Tracker</title>
    <script>
        function saveData() {
            let weight = document.getElementById("weightInput").value;
            let calories = document.getElementById("caloriesInput").value;
            let protein = document.getElementById("proteinInput").value;
            let fats = document.getElementById("fatsInput").value;
            let carbs = document.getElementById("carbsInput").value;
            let date = new Date().toISOString().split('T')[0];
            
            if (!weight || !calories || !protein || !fats || !carbs) {
                alert("Please enter all fields.");
                return;
            }
            
            let data = { date: date, weight: parseFloat(weight), calories: parseInt(calories), protein: parseFloat(protein), fats: parseFloat(fats), carbs: parseFloat(carbs) };
            
            let storedData = localStorage.getItem("trackerData");
            let trackerData = storedData ? JSON.parse(storedData) : [];
            
            trackerData.push(data);
            localStorage.setItem("trackerData", JSON.stringify(trackerData));
            
            displayData();
        }
        
        function setWeeklyCalorieGoal() {
            let calorieGoal = document.getElementById("calorieGoalInput").value;
            if (!calorieGoal) {
                alert("Please enter a weekly calorie goal.");
                return;
            }
            localStorage.setItem("weeklyCalorieGoal", calorieGoal);
            document.getElementById("weeklyCalorieGoalDisplay").innerText = `Weekly Calorie Goal: ${calorieGoal} kcal`;
        }
        
        function displayData() {
            let trackerData = JSON.parse(localStorage.getItem("trackerData")) || [];
            let table = document.getElementById("dataTable");
            table.innerHTML = "<tr><th>Date</th><th>Weight</th><th>Calories</th><th>Protein</th><th>Fats</th><th>Carbs</th></tr>";
            
            trackerData.forEach(entry => {
                let row = table.insertRow();
                row.insertCell(0).innerText = entry.date;
                row.insertCell(1).innerText = entry.weight;
                row.insertCell(2).innerText = entry.calories;
                row.insertCell(3).innerText = entry.protein;
                row.insertCell(4).innerText = entry.fats;
                row.insertCell(5).innerText = entry.carbs;
            });
            
            calculateAverages(trackerData);
            calculateWeightTrend(trackerData);
            
            let savedCalorieGoal = localStorage.getItem("weeklyCalorieGoal");
            if (savedCalorieGoal) {
                document.getElementById("weeklyCalorieGoalDisplay").innerText = `Weekly Calorie Goal: ${savedCalorieGoal} kcal`;
            }
        }
        
        function calculateAverages(data) {
            let last7Days = data.slice(-7);
            if (last7Days.length < 7) return;
            
            let avgCalories = last7Days.reduce((sum, entry) => sum + entry.calories, 0) / 7;
            let avgWeight = last7Days.reduce((sum, entry) => sum + entry.weight, 0) / 7;
            
            document.getElementById("weeklyAvg").innerText = `7-Day Avg Calories: ${avgCalories.toFixed(2)}, 7-Day Avg Weight: ${avgWeight.toFixed(2)}`;
        }
        
        function calculateWeightTrend(data) {
            if (data.length < 7) return;
            let startWeight = data[data.length - 7].weight;
            let endWeight = data[data.length - 1].weight;
            let weightChange = endWeight - startWeight;
            document.getElementById("weightTrend").innerText = `Weight Change Over Last 7 Days: ${weightChange.toFixed(2)} lbs`;
        }
        
        function exportToSheets() {
            let trackerData = JSON.parse(localStorage.getItem("trackerData")) || [];
            let csvContent = "data:text/csv;charset=utf-8,Date,Weight,Calories,Protein,Fats,Carbs\n" + 
                trackerData.map(e => `${e.date},${e.weight},${e.calories},${e.protein},${e.fats},${e.carbs}`).join("\n");
            
            let encodedUri = encodeURI(csvContent);
            let link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "tracker_data.csv");
            document.body.appendChild(link);
            link.click();
        }
        
        window.onload = displayData;
    </script>
</head>
<body>
    <h2>Daily Weight & Calorie Tracker</h2>
    <input type="number" id="weightInput" placeholder="Enter weight" step="0.1"><br>
    <input type="number" id="caloriesInput" placeholder="Enter calories" step="1"><br>
    <input type="number" id="proteinInput" placeholder="Enter protein (g)" step="0.1"><br>
    <input type="number" id="fatsInput" placeholder="Enter fats (g)" step="0.1"><br>
    <input type="number" id="carbsInput" placeholder="Enter carbs (g)" step="0.1"><br>
    <button onclick="saveData()">Save</button>
    <br><br>
    <input type="number" id="calorieGoalInput" placeholder="Enter weekly calorie goal" step="1">
    <button onclick="setWeeklyCalorieGoal()">Set Weekly Goal</button>
    <h3 id="weeklyCalorieGoalDisplay">Weekly Calorie Goal: N/A</h3>
    <button onclick="exportToSheets()">Export to CSV</button>
    <h3 id="weeklyAvg">7-Day Avg Calories: N/A, 7-Day Avg Weight: N/A</h3>
    <h3 id="weightTrend">Weight Change Over Last 7 Days: N/A</h3>
    <table id="dataTable" border="1">
        <tr><th>Date</th><th>Weight</th><th>Calories</th><th>Protein</th><th>Fats</th><th>Carbs</th></tr>
    </table>
</body>
</html>
